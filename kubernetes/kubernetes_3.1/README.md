# Домашнее задание к занятию "Архитектура кластера k8s"

### Цель задания

Рассчитать требования к кластеру под проект   

------

### Инструменты/ дополнительные материалы, которые пригодятся для выполнения задания

- [Considerations for large clusters](https://kubernetes.io/docs/setup/best-practices/cluster-large/)
- [Architecting Kubernetes clusters — choosing a worker node size](https://learnk8s.io/kubernetes-node-size)

------

### Задание. Необходимо определить требуемые ресурсы. 
Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
2. База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
3. Кэш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий. 
5. Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

----
## Ответ: 

Если свести все условия задачи в таблицу получим: 

| Ресурс      | Количество копий | Потребление ОЗУ  | Потребление ядер (CPU) | ВСЕГО потребление ОЗУ | ВСЕГО потребление ядер |
|-------------|------------------|---------------------|------------------------|-----------------------|------------------------|
| База данных | 3                | 4 Gb                | 1                      | 12 Gb                 | 3                      |
| Кэш         | 3                | 4 Gb                | 1                      | 12   Gb               | 3                      |
| Фронтенд    | 5                | 50 Mb               | 0.2                    | 250 Mb                | 1                      |
| Бекенд      | 10               | 600 Mb              | 1                      | 6 Gb                  | 10                     |
| ИТОГО:      |               |             |                | 30,25 Gb              | 17                     |

Количество рабочих нод: 

Для обеспечение отказоусточивости кластера лучше всего использовать как минимум 2 control plane - ноды. Согласно [минимальным требованиям](https://docs.kublr.com/installation/hardware-recommendation/) для control plane node необходимо использовать минимум 2 Gb ОЗУ и 1,5 CPU (поэтому запланиурем чуть больше - 2 Gb ОЗУ, 2 ядра CPU).
Итого на 2 Control plane nodes 4 Гб ОЗУ и 4 CPU.

Для базы данных - 1 Worker node, для кэша - 1 Worker node, для приложения (фронтэнд и бэкэнд) - 1 wokrer node.
Каждая worker node минимум потребляет 700Мб ОЗУ и 0,5 CPU. Заложим чуть больше и получим потребление 1 CPU и 1 Гб ОЗУ. 
Итого на 3 worker nodes 3 Гб ОЗУ и 3 CPU.

В случае выхода из строя одной ноды ее нагрузка будет распределена на оставшиеся ноды. Поэтому запас вычеслительных ресурсов должен быть 33%+, в нашем случае лучше взять 40%. 

## Итого требуемые ресурсы: 

CPU = 1,4 (40% запас) * 17 (количество ядер потребляемых всей нагрузкой по условию) + 7 (количество ядер на control-plane и worker-nodes) = 30,8 ~= 31 CPU

ОЗУ = 1,4 (40% запас) * 30,25 (количество ОЗУ потребляемых всей нагрузкой по условию) + 7 (количество ядер на control-plane и worker-nodes) = 49,35 ~= 50 Гб ОЗУ






### Правила приема работы

1. Домашняя работа оформляется в своем Git репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Сначала сделайте расчет всех необходимых ресурсов 
3. Затем прикиньте количество рабочих нод, которые справятся с такой нагрузкой. 
4. Добавьте к полученным цифрам запас, который учитывает выход из строя как минимум одной ноды. 
5. Добавьте служебные ресурсы к нодам. Помните, что для разных типов нод требовния к ресурсам разные. 
6. В результате должно быть указано количество нод и их параметры.
