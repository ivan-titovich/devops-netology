# Домашнее задание к занятию "10.06. Инцидент-менеджмент"

## Задание 

Составьте постмортем, на основе реального сбоя системы Github в 2018 году.

Информация о сбое доступна [в виде краткой выжимки на русском языке](https://habr.com/ru/post/427301/) , а
также [развёрнуто на английском языке](https://github.blog/2018-10-30-oct21-post-incident-analysis/).

---

#Постмортем

| Этап                       | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Краткое описание инцидента | Кратковременный обрыв соединения (43 секунды) между сетевым хабом и основным дата-центром на восточном побережье США вызвал цепочку событий, сделавших недоступными web-сервера github.com на 24 часа 11 минут.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Предшествующие события     | Замена 100G оптического модуля на сетевом хабе восточного побережья США.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Причина инцидента          | Во время обрыва связи оркестратор MySQL по алгоритму консенсуса RAFT выбрал основным сервером MySQL сервер на западном побержье США и после восстановления соединения начался перенос данных на главный сервер.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Воздействие                | Не были доступны web-сервера github.com в течении 24 часов и 11 минут.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Обнаружение                | 2018 October 21 22:54 UTC Дежурные инженеры начали фиксировать множество уведомлений об ошибках, после анализа которых стало ясно, что не доступны сервера с восточного побережья США.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Реакция                    | За 13 минут (с 22:54 до 23:09) был проведен проведен анализ уведомлений, в общих чертах определен масштаб инцидента и вручную изменен статус серверов на "желтый". Инцидент-координатор, оценив за 2 минуты повысли статус инцидента до уровня "красный".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Восстановление             | Был разработан план восстановления бэкапов на задеты сервера и в 00:41 UTC был запущен процесс.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Таймлайн                   | 2018 October 21 22:52 UTC - Оркестратор запустил процесс выбора главного сервера.<br/> 2018 October 21 22:54 UTC - Фиксация дежурной командой уведомлений об инциденте.<br/>2018 October 21 23:07 UTC - присвоение аварии желтого статуса<br/>2018 October 21 23:11 UTC - присвоение красного статуса.<br/>2018 October 21 23:13 UTC - Была собрана команда для инженеров баз данных. Начался анализ происшествия.<br/>2018 October 21 23:19 UTC - Было принято решение об отключении части функций гитахаба для предовращения усугубления ситуации. <br/> 2018 October 22 00:05 UTC - начался процесс разработки плана восстановления после сбоя.<br/> 2018 October 22 00:41 UTC - начался процесс восстановления БД из бэкапов.<br/> 2018 October 22 06:51 UTC - Некоторые из кластеров на восточном побережья восстановились. Процесс восстановления продолжился.<br/>2018 October 22 07:46 UTC - Опубликована дополнительная информация о сбое для клиентов.<br/> 2018 October 22 11:12 UTC- Все БД приемущественно базирующиеся в восточном побережье восстановлены, но в связи с началом рабочего дня в Европе процесс восстановления замедлился.<br/>2018 October 22 13:15 UTC - в связи с увеличением трафика на сервера github.com было принято решение о увеличении количества серверов.<br/>2018 October 22 16:24 UTC - часть функционала восстановлена, но уровень инцидента все еще красный - уведомили пользователей. <br/>2018 October 22 16:45 UTC - в связи с большим количеством web-hooks и просадкой серверов - пришлось увеличить TTL для веб-хуков, чтобы они не дропались. <br/>2018 October 22 23:03 UTC - работоспособность полностью восстановлена. |
| Последующие действия       | Анализ данных для восстановления ( на предмет дублирования)<br/> Сделаны выводы о проблемах информирования пользователей.<br/> <br/> Технические решения: <br/> Пересмотрена логика работы оркестратора БД.<br/> Введен новый механизм уведомлений (публикация статусов для каждой службы) <br/> Начата работа по поддержке обслуживания трафика гитхаба из дата-центров. <br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |




